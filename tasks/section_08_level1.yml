---
#
# Copyright 2014 Major Hayden
#
#   Licensed under the Apache License, Version 2.0 (the "License");
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.
#

# stat /etc/motd to capture file type
  - name: 8.1 Set Warning Banner for Standard Login Services (Scored)
    shell: stat -c=%F /etc/motd
    register: stat_motd
    changed_when: false
    ignore_errors: yes
    always_run: yes
    tags:
      - scored
      - section8.1

# Remove symlink if /etc/motd is a symlink
  - name: 8.1 Set Warning Banner for Standard Login Services (Scored)
    file: >
      name=/etc/motd 
      state=absent
    changed_when: false
    when: stat_motd.stdout == '=symbolic link'
    tags:
      - scored
      - section8.1

# Populate /etc/motd with official content
  - name: 8.1 Set Warning Banner for Standard Login Services (Scored)
    copy: >
      src=etc/motd
      dest=/etc/motd
    tags:
      - scored
      - section8.1

# stat /etc/issue to capture file type
  - name: 8.1 Set Warning Banner for Standard Login Services (Scored)
    shell: stat -c=%F /etc/issue
    register: stat_issue
    changed_when: false
    ignore_errors: yes
    always_run: yes
    tags:
      - scored
      - section8.1

# Remove symlink if /etc/issue is a symlink
  - name: 8.1 Set Warning Banner for Standard Login Services (Scored)
    file: >
      name=/etc/issue 
      state=absent
    changed_when: false
    when: stat_issue.stdout == '=symbolic link'
    tags:
      - scored
      - section8.1

# Populate /etc/issue with official content
  - name: 8.1 Set Warning Banner for Standard Login Services (Scored)
    copy: >
      src=etc/issue
      dest=/etc/issue
    tags:
      - scored
      - section8.1

# stat /etc/issue.net to capture file type
  - name: 8.1 Set Warning Banner for Standard Login Services (Scored)
    shell: stat -c=%F /etc/issue.net
    register: stat_issue_net
    changed_when: false
    ignore_errors: yes
    always_run: yes
    tags:
      - scored
      - section8.1

# Remove symlink if /etc/issue.net is a symlink
  - name: 8.1 Set Warning Banner for Standard Login Services (Scored)
    file: >
      name=/etc/issue.net
      state=absent
    changed_when: false
    when: stat_issue_net.stdout == '=symbolic link'
    tags:
      - scored
      - section8.1

# Populate /etc/issue with official content
  - name: 8.1 Set Warning Banner for Standard Login Services (Scored)
    copy: >
      src=etc/issue.net
      dest=/etc/issue.net
    tags:
      - scored
      - section8.1

  - name: 8.1 Set Warning Banner for Standard Login Services (Scored)
    file: >
      path=/etc/{{ item }}
      owner=root
      group=root
      mode=0644
    with_items:
      - motd
      - issue
      - issue.net
    tags:
      - scored
      - section8.1

  - name: 8.2 Remove OS Information from Login Warning Banners (Scored)
    replace: >
      dest=/etc/{{ item }}
      regexp='\\r|\\v|\\s' 
      replace='[CIS replaced]'
    with_items:
      - motd
      - issue
      - issue.net 
    tags:
      - scored
      - section8.2

  - name: 8.3 Set GNOME Warning Banner (Not Scored)
    debug: msg="*** Will do later"
    tags:
      - scored
      - section8.3
